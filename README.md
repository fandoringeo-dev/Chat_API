# FastAPI Chat Service

REST API сервис для системы обмена сообщениями. Проект реализует базовый функционал мессенджера с поддержкой создания чатов, отправки сообщений и управления историей переписки. Упакован в Docker контейнеры для быстрого развертывания и включает автоматические тесты с изолированной базой данных.

## Функциональность

API предоставляет следующие возможности:

- **Создание чатов** — создание нового чата с указанием названия
- **Просмотр чата** — получение информации о чате с последними сообщениями (с настраиваемым лимитом от 1 до 100)
- **Список всех чатов** — получение списка всех чатов с пагинацией (параметры skip и limit)
- **Отправка сообщений** — отправка текстовых сообщений в чат
- **Получение сообщений из чата** — просмотр истории сообщений с поддержкой пагинации
- **Удаление чатов** — удаление чата со всеми его сообщениями
- **Проверка здоровья API** — встроенный эндпоинт для проверки статуса сервера

## Технологический стек

- **FastAPI** — асинхронный веб-фреймворк
- **SQLAlchemy** — ORM для работы с базой данных (асинхронный режим)
- **PostgreSQL** — основная база данных
- **Docker & Docker Compose** — контейнеризация и оркестрация
- **Pytest** — автоматизированное тестирование
- **Pydantic** — валидация данных

## Структура проекта

```
project_root/
├── app/
│   ├── models.py         # SQLAlchemy модели (Chat, Message)
│   ├── database.py       # Настройка подключения к БД
│   ├── depends.py        # Зависимости FastAPI
│   ├── schemas.py        # Pydantic схемы
│   └── main.py           # Точка входа приложения
├── tests/
│   ├── conftest.py       # Фикстуры для тестов
│   └── test_*.py         # Тестовые модули
├── docker-compose.yml    # Конфигурация Docker Compose
├── Dockerfile            # Образ приложения
├── init.sql              # Инициализация тестовой БД
├── requirements.txt      # Python зависимости
└── README.md
```

## Предварительные требования

**Для запуска с Docker (рекомендуется):**
- Docker Desktop (версия 20.10+)
- Docker Compose (версия 2.0+)

**Для локальной разработки без Docker:**
- Python 3.13+
- PostgreSQL 15+

## Быстрый старт

### 1. Клонирование репозитория

```bash
git clone https://github.com/fandoringeo-dev/Chat_API.git
cd <папка-проекта>

### Шаг 1: Подготовка файлов окружения

<<<<<<< HEAD
=======
**Создайте файл `.env` в корне проекта:**

```env
DATABASE_URL="postgresql+asyncpg://chat_user:your_secure_password@db:5432/chat_api"
DB_HOST="db"
DB_USER="chat_user"
DB_PASSWORD="your_secure_password"
DB_PORT="5432"
DB_NAME="chat_api"
```

>>>>>>> 1143a3a62005fb301cc14962110ef77265f7ffd0
**Создайте файл `.test.env` в корне проекта:**

```env
DATABASE_URL="postgresql+asyncpg://test_user:test_password@db:5432/chat_db_test"
DB_HOST="db"
DB_USER="test_user"
DB_PASSWORD="123456"
DB_PORT="5432"
DB_NAME="chat_db_test"
```

### Шаг 2: Запуск с Docker Compose

```bash
# Запустить контейнеры (приложение + база данных)
docker-compose up

# В отдельном терминале: прогнать тесты
docker-compose run --rm tests
```

Приложение будет доступно по адресу: `http://localhost:8000`

API документация (Swagger): `http://localhost:8000/docs`


## Команды для управления контейнерами

**Остановить контейнеры:**
```bash
docker-compose down
```

**Полная очистка (удалить контейнеры и данные БД):**
```bash
docker-compose down -v
```

**Посмотреть логи приложения:**
```bash
docker-compose logs -f app
```

**Посмотреть логи базы данных:**
```bash
docker-compose logs -f db
```

Приложение будет доступно по адресу: `http://localhost:8000`

## Тестирование

Проект включает набор интеграционных и unit-тестов. Они используют собственную базу данных (`chat_db_test`), которая автоматически очищается.

**Прогнать все тесты:**
```bash
docker-compose run --rm tests
```


